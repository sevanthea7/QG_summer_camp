## 实践步骤

eg.音频网站

1. 网页中随便点点开一个音频链接，用链接后几位在inspector中搜索，找链接入口特征

   如存在明显特征 h2 -> a -> href

   ~~~python
   all_h2 = soup.findAll( 'h2', class_='over_text1 font16' )
   all_links = soup.findAll('a')
   link_box = []
   for h2 in all_h2:
       a_tag = h2.find('a')
       if a_tag:
           href = a_tag.get('href')
           link_f = 'https://stock.zhipianbang.com' + href
           link_box.append( link_f )
   ~~~

   把收集的网页装进列表备用

2. 在连接中通过搜索mp3或audio，找音频下载连接到的特征，从收集的列表中依次读入网址，通过特征找到音频

   ~~~python
   for link in link_box:
       response_t = requests.get( link, headers=headers )
       content_t = response_t.text
       soup_t = BeautifulSoup( content_t, 'html.parser' )
       c_all = soup_t.find( 'audio' )
       if c_all:
           data_url = 'https:' + c_all.get( 'src' )
           print( data_url )
           response_f = requests.get(data_url, headers=headers)
   ~~~

3. 保存音频到指定文件夹

   ~~~python
           if response_f.status_code == 200:
               # 指定保存路径
               with open(f'../test/talk_sound{i}.mp3', 'wb') as file:
   
                   file.write( response_f.content )
               print(f'MP3 file downloaded{i}')
           else:
               print(f"Failed to retrieve MP3 file{i + 1}. Status code:", response.status_code)
   ~~~

- 出现标签很确定存在但是报错找不到指定标签的情况：在`request.get()`中添加headers，可能是被拦了





## Socket

1.建造服务端

~~~python
import socket
server = socket.socket()

# 1.绑定服务器 -> 0.0.0.0: 允许所有人来访，8800：端口号
server.bind( ( '0.0.0.0', 8800 ) )

# 2.监听
server.listen( 5 )

while True:
	# 3.等待连接 -> accept：阻塞方法，每一个连接创建一个单独的通道
	conn, addr = server.accept()
    # conn：通道参数；addr：通道地址
    
    # 4.接收数据
    data = conn.recv( 1024 )
    print( data )
    
    response = "HTTP/1.1 200 OK\r\nContent-Type: text/html;charset=utf-8;\r\n\r\n<h1 style='color:black'>12345<h1>"
    
    # 5. 发送数据
    conn.send( response.encode() )
    print( '已响应' )
    
server.close()
~~~

`conn.recv( 1024 )`：最多读取1024字节的数据，这个方法是阻塞的，会一直等待知道从客户端接收到数据位置，接收的数据存放在data中

`HTTP/1.1 200 OK\r\nContent-Type: text/html;charset=utf-8;\r\n\r\n<h1 style='color:black'>12345<h1>`：HTTP响应消息，包含状态行、响应头、响应体

- 状态行：`HTTP/1.1 200 OK` 表示HTTP版本是1.1，状态码是200，表示请求成功。
- 响应头：`Content-Type: text/html;charset=utf-8;` 表示内容类型是HTML文档，字符编码是UTF-8。
- 响应体：`<h1 style='color:black'>我很帅！<h1>` 是HTML内容，在浏览器中会显示一个黑色字体的标题12345

-> 在本地浏览器`127.0.0.1：8800`：会显示访问的网页



2.建造客户端

~~~python
import socket

client = socket.socket()			# 建立服务器对象

# 1. 建立连接
client.connect( ( 'www.baidu.com', 80 ) )

# 2.构造请求报文
data = b"GET / HTTP/1.1\r\nHost: www.baidu.com\r\n\r\n"
# 发送请求
client.send( data )
res = b""

# 3.接收数据
temp = client.recv( 1024 )
while temp:
    print( "*" * 50 )
    res += temp
    temp = client.recv( 1024 )
    print( temp.decode() )
    
client.close()
~~~

